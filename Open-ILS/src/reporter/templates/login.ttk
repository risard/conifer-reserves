<html>

	[% INCLUDE header.ttk title="Login" %]

	<body onload='initPage();'>

		<script language='javascript'>

			function initPage() {
   			document.getElementById("reports_login_username").focus();
   			document.getElementById("reports_login_username").onkeypress = checkInputClicks;
   			document.getElementById("reports_login_password").onkeypress = checkInputClicks;
			}

			function checkInputClicks(evt) {
				if(userPressedEnter(evt)) doLogin();
			}


			function doLogin() {

   			var uname = document.getElementById("reports_login_username").value;
   			var passwd = document.getElementById("reports_login_password").value;
			
   			var init_request = new RemoteRequest( 
					"open-ils.auth", 
					"open-ils.auth.authenticate.init", uname );
	
   			init_request.send(true);
   			var seed = init_request.getResultObject();
			
   			if( ! seed || seed == '0') {
      				alert( "Error Communicating with Authentication Server" );
      				return null;
   			}
			
   			var auth_request = new RemoteRequest( 
					"open-ils.auth", "open-ils.auth.authenticate.complete",
					{	
						username : uname,
						password : hex_md5(seed + hex_md5(passwd)),
						type : "staff" 
					});
			
   			auth_request.send(true);
   			var auth_result = auth_request.getResultObject().payload.authtoken;
			
   			if(auth_result == '0' || auth_result == null || auth_result.length == 0) { 
					alert("Login failed");
					return false; 
				}
	
				cookieManager.write(COOKIE_SES, auth_result, '+1d');
				location.href = location.href;
		
			}

		</script>

		<br/>
		<center>
		<h3> Reports Login </h3>
		<table style='padding: 4px; border: 2px solid #E0E0E0;'>
			<tr>
				<td >Username: </td>
				<td ><input type='text' id='reports_login_username'/></td>
			</tr>
			<tr>
				<td >Password: </td>
				<td ><input type='password' id='reports_login_password'/></td>
			<tr>
			</tr>
				<td><input type='submit' value='Login' onclick='doLogin();'/></td>
			</tr>
		</table>
		</center>

	</body>

	[% INCLUDE footer.ttk %]

</html>




